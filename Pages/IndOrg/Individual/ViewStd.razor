@page  "/{thisDir}/{thisSubDir}/{thisPage}/{Id}"
@inject IndividualController MainController

<WrAuth PageName="@PageNameForTransl"><MainContent>   
        
    <WrDataGrid @ref="_grid"
                  DataItems="_list"
                  SelectedRow="SelectedRowMeth"
                  Columns="@MainController.columns"
                  UniqIdOfRecord=@UniqIdOfRecord
                  ColumnsToExcludeCSV=@ColumnsToExcludeCsv
                  PageNameTitle=@PageNameTitle
                  BackLink=@BackLink
                  Paging="@(new PagingConfig
                            {
                                Enabled = true,
                                CustomPager = false,
                                PageSize = @AppData.rowNumMid
                            })">

        <ControlMenu>
            <WrOper Design="a" Type="C"  Link=@OperLink SubPage="Add"     Txt="Add" />
            <WrOper Design="a" Type="R"  Link=@OperLink SubPage="View/"   LinkId=@SelectedId Txt="View" />
            <WrOper Design="a" Type="U"  Link=@OperLink SubPage="Edit/"   LinkId=@SelectedId Txt="Edit" />
            <WrOper Design="a" Type="D"  Link=@OperLink SubPage="Delete/" LinkId=@SelectedId Txt="Delete" />
        </ControlMenu>

        <ControlQuickAccess>
            <WrSrchDGrid OnSearchTextChanged="SearchTxt"> </WrSrchDGrid>
            <WrSpace Length=2/>
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-angle-double-down" OnClickCallback="@CleanSearchBox"  TxtToolTip="ShowMoreRecords" />
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-hand-pointer-o" OnClickCallback="@FindSelectedRec" TxtToolTip="Choose"/>
            <WrSpace Length=2/>
            <WrOper Design="btn" Type="C" Ico="fa fa-plus"   Link=@OperLink SubPage="Add"    TxtToolTip="Add" />
            <WrOper Design="btn" Type="R" Ico="fa fa-file"   Link=@OperLink SubPage="View/"   LinkId=@SelectedId TxtToolTip="View" />
            <WrOper Design="btn" Type="U" Ico="fa fa-pencil" Link=@OperLink SubPage="Edit/"   LinkId=@SelectedId TxtToolTip="Edit" />
            <WrOper Design="btn" Type="D" Ico="fa fa-trash"  Link=@OperLink SubPage="Delete/" LinkId=@SelectedId TxtToolTip="Delete" />
            <WrSpace Length=2/>
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-filter" OnClickCallback="@FilterData"  TxtToolTip="Filter" />
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-file-excel-o" OnClickCallback="@ExportToExcel" TxtToolTip="ExportToExcel"/>
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-file-excel-o" OnClickCallback="@(e=>ConfirmDelete("Test Message"))" TxtToolTip="ExportToExcel"/>
        </ControlQuickAccess>
    </WrDataGrid>
   </MainContent></WrAuth>


@code  {

 #region     Declare

    private WrDataGrid<Individual> _grid;
    private List<Individual> _list;
    
    [Parameter] public string Id { get; set; } 
    [Parameter] public string ThisDir { get; set; }="IndOrg";  
    [Parameter] public string ThisSubDir { get; set; }="Individual";
    [Parameter] public string ThisPage { get; set; }="ViewStd"; 
    [Parameter] public string UniqIdOfRecord { get; set; }="Id";  
    [Parameter] public string ColumnsToExcludeCsv { get; set; }="Id, FirstName"; 
    [Parameter] public string BackLink  { get; set; }="/MainMenu";  
    [Parameter] public string SelectedId { get; set;}="0";

    private string OperLink => "/" +ThisDir+ "/" + ThisSubDir+ "/ ";
    private string PageNameForTransl{ get{ return  ThisSubDir+  ThisPage;}}
    private string PageNameTitle { get{ return  PageNameForTransl+"::"+ThisSubDir;}}
 
 #endregion  Declare

 #region    BlazorMethods


    protected override void OnInitialized()
    {
        MainController.Initialized();
        _list = MainController.GetById(int.Parse(Id)).ToList();       
    }

    protected void ConfirmDelete(string title)
{
 
    //RegisteredFunction.Invoke<bool>("confirmDelete", title);
}

#endregion BlazorMethods

#region    Event
    protected void CleanSearchBox()
    {
        _grid.GoToFirstPage();
        _list = MainController.GetSearchByField("");
        SelectedId="0";
    }
    private void SelectedRowMeth(string pSelectedRow)
    {
        SelectedId= pSelectedRow;
    }

    private void SearchTxt(ChangeEventArgs changeEventArgs)
    {
        string searchValue = changeEventArgs.Value.ToString();
        _list = MainController.GetSearchByField(searchValue);
        _grid.GoToFirstPage();
    }

    protected void FindSelectedRec()
    {
        _grid.GoToFirstPage();
        _list = MainController.GetById(int.Parse(SelectedId));
    }

    protected void ExportToExcel()
    {
        MainController.GenerateExcel(JSRuntime);
    }
    protected void FilterData()
    {
        JSRuntime.InvokeVoidAsync("msgbox", "FilterData");
    }
 #endregion Event

}
