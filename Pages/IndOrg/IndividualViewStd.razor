@page  "/IndOrg/IndividualViewStd/{Id}"
@inject IndividualController MainController
@* @inject IStringLocalizer<IndividualViewStd> LL  *@

@if (list == null)
{
   <WrLoading/>   
}
else
{
<AuthorizeView Roles="@admSer.GetRolesList("IndividualViewStd")" Context="authContext">
   <Authorized>
    <WrDataGrid @ref="grid"
                  DataItems="list"
                  SelectedRow="SelectedRowMeth"
                  Columns="@MainController.columns"
                  BaseUrlUri="@AppData.BaseUrlUri"
                  UniqIdOfRecord="Id"
                  ColumnsToExcludeCSV="Id, FirstName"
                  PageNameTitle="@trs.GetTranslation("IndividualViewStd",@AppData.ActiveUser,"Individual")"
                  BackLink="@AppData.MainMenuUrl"
                  Paging="@(new PagingConfig
                            {
                                Enabled = true,
                                CustomPager = false,
                                PageSize = @AppData.rowNumMid
                            })">

        <ControlMenu>
            <WrOper Design="a" Type="C"  Link="/IndOrg/IndividualAdd"     Txt="Add" />
            <WrOper Design="a" Type="R"  Link="/IndOrg/IndividualEdit/"   LinkId=@AppData.Individual_IdSelect Txt="View" />
            <WrOper Design="a" Type="U"  Link="/IndOrg/IndividualEdit/"   LinkId=@AppData.Individual_IdSelect Txt="Edit" />
            <WrOper Design="a" Type="D"  Link="/IndOrg/IndividualDelete/" LinkId=@AppData.Individual_IdSelect Txt="Delete" />
        </ControlMenu>

        <ControlQuickAccess>

            <WrSrchDGrid OnSearchTextChanged="SearchTxt"> </WrSrchDGrid>
            <WrSpace Length=2/>
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-angle-double-down" OnClickCallback="@CleanSearchBox"  TxtToolTip="ShowMoreRecords" />
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-hand-pointer-o" OnClickCallback="@FindSelectedRec" TxtToolTip="Choose"/>
            <WrSpace Length=2/>
            <WrOper Design="btn" Type="C" Ico="fa fa-plus"   Link="/IndOrg/IndividualAdd"     TxtToolTip="Add" />
            <WrOper Design="btn" Type="R" Ico="fa fa-file"   Link="/IndOrg/IndividualEdit/"   LinkId=@AppData.Individual_IdSelect TxtToolTip="View" />
            <WrOper Design="btn" Type="U" Ico="fa fa-pencil" Link="/IndOrg/IndividualEdit/"   LinkId=@AppData.Individual_IdSelect TxtToolTip="Edit" />
            <WrOper Design="btn" Type="D" Ico="fa fa-trash"  Link="/IndOrg/IndividualDelete/" LinkId=@AppData.Individual_IdSelect TxtToolTip="Delete" />
            <WrSpace Length=2/>
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-filter" OnClickCallback="@FilterData"  TxtToolTip="Filter" />
            <WrOper Category="RunCmd" Design="btn" Ico="fa fa-file-excel-o" OnClickCallback="@ExportToExcel" TxtToolTip="ExportToExcel"/>
        </ControlQuickAccess>
    </WrDataGrid>
</Authorized>
 <NotAuthorized>
   <WrPageNotFound/>
 </NotAuthorized>
 </AuthorizeView>
}

@code  {


 #region     Declare
    [Parameter]
    public string Id { get; set; }
    private WrDataGrid<Individual> grid;
    private List<Individual> list;

 
 #endregion  Declare

 #region    BlazorMethods

    protected override void OnInitialized()
    {
        MainController.Initialized();
        AppData.BaseUrlUri=NavManager.Uri.ToString(); 
        list = MainController.GetById(int.Parse(Id)).ToList();         
    }

#endregion BlazorMethods

#region    Event
    private void SearchTxt(ChangeEventArgs changeEventArgs)
    {
        string searchValue = changeEventArgs.Value.ToString();
        list = MainController.GetSearchByField(searchValue);
        grid.GoToFirstPage();
    }
    private void SelectedRowMeth(string pSelectedRow)
    {
        AppData.Individual_IdSelect = pSelectedRow;
    }
    protected void FindSelectedRec()
    {
        grid.GoToFirstPage();
        list = MainController.GetById(int.Parse(AppData.Individual_IdSelect));
    }
    protected void CleanSearchBox()
    {
        grid.GoToFirstPage();
        list = MainController.GetSearchByField("");
        AppData.Individual_IdSelect = "0";
    }
    protected void ExportToExcel()
    {
        MainController.GenerateExcel(JSRuntime);
    }
    protected void FilterData()
    {
        JSRuntime.InvokeVoidAsync("msgbox", "FilterData");
    }
 #endregion Event

}
